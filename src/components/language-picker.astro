---
import { languages } from '../i18n/ui';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { Globe } from 'lucide-react';

// Get current locale from URL
const currentLocale = Astro.currentLocale;
const otherLangs = Object.entries(languages).filter(([code]) => code !== currentLocale);

// Generate URL for each locale preserving current path
function getLocaleUrl(locale: string) {
	const pathname = Astro.url.pathname;
	// Remove current locale prefix if present
	const pathWithoutLocale = pathname.replace(new RegExp(`^/${currentLocale}(?=/)`), '');
	return getRelativeLocaleUrl(locale, pathWithoutLocale || '/');
}
---

<div class="relative group" id="language-picker">
	<button
		class="hidden sm:flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors px-3 py-1.5 rounded-md hover:bg-muted/50"
		aria-label="Switch language"
	>
		<Globe className="w-4 h-4" />
		<span class="uppercase font-medium">{currentLocale}</span>
	</button>

	<!-- Dropdown menu -->
	<div class="absolute right-0 top-full mt-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
		<div class="bg-card border border-border rounded-lg shadow-lg py-1 min-w-35">
			{otherLangs.map(([code, label]) => (
				<a
					href={getLocaleUrl(code)}
					class="block px-3 py-2 text-sm text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-colors first:rounded-t-lg last:rounded-b-lg"
				>
					<span class="inline-flex items-center gap-2">
						<span class="text-xs opacity-60 uppercase">{code}</span>
						{label}
					</span>
				</a>
			))}
		</div>
	</div>
</div>
